---
import Layout from "@layouts/Layout.astro";
import Profile from "@svelte/profile/index.svelte";

const currentUser = await Astro.locals.currentUser();
const { sessionId, userId, sessionClaims, redirectToSignIn } =
  Astro.locals.auth();

if (!sessionId || !userId || !sessionClaims || !currentUser){
  return redirectToSignIn();
}

const session = {
  id: sessionId,
  expires: `${sessionClaims.exp}`,
  user: {
    id: userId,
    name: currentUser.fullName,
    email: currentUser.primaryEmailAddress?.emailAddress,
    image: currentUser.imageUrl,
  },
};
---

<Layout>
  <Profile {session} client:only="svelte" />
</Layout>
